<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard IoT - Sensores</title>
    
    <!-- Chart.js Libraries (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- CSS Externo -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š Dashboard IoT - Sensores</h1>
            <p class="subtitle">Monitoramento em tempo real dos dispositivos e sensores</p>
            <div style="margin-top: 15px;">
                <button class="refresh-btn" onclick="loadAllData()">ğŸ”„ Atualizar Dados</button>
                <button class="refresh-btn" onclick="window.location.href='/'">ğŸ  Controle</button>
                <span class="last-update" id="lastUpdate">Ãšltima atualizaÃ§Ã£o: --</span>
            </div>
            <div id="jsStatus" style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; display: none;">
                âš ï¸ JavaScript nÃ£o estÃ¡ executando corretamente
            </div>
        </header>

        <script>
            // Esconde o aviso se JS estÃ¡ funcionando
            document.getElementById('jsStatus').style.display = 'none';
            console.log('âœ… JavaScript estÃ¡ executando!');
        </script>

        <!-- EstatÃ­sticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total de ESPs</h3>
                <div class="stat-value" id="totalEsps">--</div>
                <div class="stat-label">Dispositivos registrados</div>
                <div id="espsList" style="margin-top: 15px; display: none;"></div>
            </div>
            <div class="stat-card">
                <h3>Total de Sensores</h3>
                <div class="stat-value" id="totalSensores">--</div>
                <div class="stat-label">Sensores cadastrados</div>
            </div>
            <div class="stat-card">
                <h3>Total de Leituras</h3>
                <div class="stat-value" id="totalLeituras">--</div>
                <div class="stat-label">Registros no banco</div>
            </div>
            <div class="stat-card">
                <h3>Filtro Ativo</h3>
                <div class="stat-value" style="font-size: 20px;" id="currentFilter">Todos</div>
                <div class="stat-label" id="statusDetail">Visualizando todas as ESPs</div>
                <button class="refresh-btn" onclick="clearFilter()" style="margin-top: 10px; display: none;" id="clearFilterBtn">ğŸ”„ Ver Todas</button>
            </div>
        </div>

        <!-- GrÃ¡ficos -->
        <div class="charts-grid">
            <div class="chart-card">
                <h2>ğŸ“ˆ Leituras por ESP</h2>
                <div class="chart-container">
                    <canvas id="chartEsps"></canvas>
                </div>
            </div>
            <div class="chart-card">
                <h2>ğŸ“Š Leituras por Sensor</h2>
                <div class="chart-container">
                    <canvas id="chartSensores"></canvas>
                </div>
            </div>
        </div>

        <!-- Ãšltimas Leituras Detalhadas -->
        <div class="chart-card">
            <h2>ğŸ“‹ Ãšltimas Leituras (50 mais recentes)</h2>
            <div class="table-container" id="readingsTableContainer">
                <div class="loading">Carregando leituras...</div>
            </div>
        </div>

        <!-- Timeline de Leituras - MÃºltiplos GrÃ¡ficos -->
        <div id="timelineChartsContainer">
            <!-- GrÃ¡ficos serÃ£o gerados dinamicamente aqui -->
        </div>

        <!-- Valores Recentes por Sensor -->
        <div class="chart-card">
            <h2>ğŸ”¢ Valores Recentes dos Sensores</h2>
            <div id="valoresRecentesContainer">
                <div class="loading">Carregando valores...</div>
            </div>
        </div>
    </div>


    <!-- JavaScript Externo (carrega APÃ“S o HTML) -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
